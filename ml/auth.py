"""
Автор: Федотова Анастасия Алексеевна
Тема ВКР:
Автоматическая генерация и проверка учебных заданий
по языку программирования Python с помощью нейронных сетей
(на примере ЧОУ ВО «Московский университет имени С.Ю. Витте»)

Назначение:
Модуль аутентификации и управления пользователями.
Используется в десктопном приложении (PyQt5).
"""

from ml.database import (
    init_db,
    add_user,
    get_user,
    get_all_users
)

# -------------------------------------------------
# ИНИЦИАЛИЗАЦИЯ СИСТЕМЫ
# -------------------------------------------------

def init_system():
    """
    Инициализация БД и создание пользователей по умолчанию.
    Вызывается при запуске приложения.
    """
    init_db()

    # Пользователи по умолчанию (для демонстрации ВКР)
    add_user("student", "student")
    add_user("teacher", "teacher")
    add_user("admin", "admin")


# -------------------------------------------------
# АУТЕНТИФИКАЦИЯ
# -------------------------------------------------

def login(username: str):
    """
    Простейшая аутентификация по имени пользователя.
    (без паролей — допустимо для учебной системы)
    """
    if not username:
        return None

    user = get_user(username)
    return user


# -------------------------------------------------
# УПРАВЛЕНИЕ ПОЛЬЗОВАТЕЛЯМИ
# -------------------------------------------------

def register_user(username: str, role: str):
    """
    Регистрация нового пользователя (администратор).
    """
    if not username or role not in ("student", "teacher", "admin"):
        raise ValueError("Некорректные данные пользователя")

    add_user(username, role)


def list_users():
    """
    Получение списка всех пользователей.
    """
    return get_all_users()
